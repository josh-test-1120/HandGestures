<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arduino Data Demo</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'main_app/css/style.css' %}" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://unpkg.com/aos@2.3.4/dist/aos.css"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .chart-container {
      position: relative;
      height: 300px;
    }

    .card {
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    }

    #loadingSpinner {
      animation: fadeIn 0.8s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>
<body>
  {% include 'main_app/navbar.html' %}

  <main class="container wide-container py-5 mb-5">
    <div style="margin-top: 80px"></div>
  <div class="container mb-5">
    <h1 class="text-center mb-4" data-aos="fade-down">Arduino Data Demo</h1>

    <!-- Loading Spinner -->
    <div
      id="loadingSpinner"
      class="text-center my-4"
      style="display: none"
      data-aos="fade-up"
    >
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <div class="mt-2 text-muted">Loading and visualizing data...</div>
    </div>

    <!-- Accelerometer and Gyroscope -->
    <div class="row mb-4">
      <div class="col-md-6" data-aos="fade-up" data-aos-delay="100">
        <div class="card shadow-sm p-4 mb-5 rounded">
          <h5 class="card-title">Accelerometer</h5>
          <div class="chart-container" style="height: 300px;">
            <canvas id="accelerometerChart"></canvas>
          </div>
        </div>
      </div>
      <div class="col-md-6" data-aos="fade-up" data-aos-delay="200">
        <div class="card shadow-sm p-4 mb-5 rounded">
          <h5 class="card-title">Gyroscope</h5>
          <div class="chart-container" style="height: 300px;">
            <canvas id="gyroscopeChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Ultrasonic -->
    <div class="card shadow-sm p-4 mb-5 rounded" data-aos="fade-up" data-aos-delay="300">
      <h5 class="card-title">Ultrasonic Sensor</h5>
      <div class="chart-container" style="height: 300px;">
        <canvas id="ultrasonicChart"></canvas>
      </div>
    </div>

    <!-- Debug Info -->
    <div class="text-center text-muted mt-4 small" data-aos="fade-in">
      <p><strong>Template:</strong> main_app/live_demo.html</p>
      <p><strong>Time:</strong> {% now "DATETIME_FORMAT" %}</p>
    </div>
  </div>

  </main>

   <!--Footer-->
  <footer id="mainFooter" class="py-1 mt-5">
    <div class="container text-center">
      <p class="mb-0 small">Â© 2025 Central Washington University</p>
    </div>
  </footer>


  

  <!-- AOS + Bootstrap JS -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 1000, once: true });
  </script>

  <script>
    const accCtx = document.getElementById("accelerometerChart").getContext("2d");
    const gyroCtx = document.getElementById("gyroscopeChart").getContext("2d");
    const ultrasonicCtx = document.getElementById("ultrasonicChart").getContext("2d");

    let accelerometerChart = new Chart(accCtx, {
      type: "line",
      data: { labels: [], datasets: [] },
      options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: "linear", title: { display: true, text: "Time (s)" } }, y: { beginAtZero: true } } }
    });

    let gyroscopeChart = new Chart(gyroCtx, {
      type: "line",
      data: { labels: [], datasets: [] },
      options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: "linear", title: { display: true, text: "Time (s)" } }, y: { beginAtZero: true } } }
    });

    let ultrasonicChart = new Chart(ultrasonicCtx, {
      type: "line",
      data: { labels: [], datasets: [] },
      options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: "linear", title: { display: true, text: "Time (s)" } }, y: { beginAtZero: true } } }
    });

    const loadingSpinner = document.getElementById("loadingSpinner");

    function parseCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      const header = lines[0].split(",");
      const idx = {
        time: header.indexOf("Timestamp(ms)"),
        ax: header.indexOf("AccelX(g)"),
        ay: header.indexOf("AccelY(g)"),
        az: header.indexOf("AccelZ(g)"),
        gx: header.indexOf("GyroX(deg/s)"),
        gy: header.indexOf("GyroY(deg/s)"),
        gz: header.indexOf("GyroZ(deg/s)"),
        dist: header.indexOf("Distance(cm)"),
      };
      let t0 = null;
      let timeArr = [], axArr = [], ayArr = [], azArr = [], gxArr = [], gyArr = [], gzArr = [], distArr = [];
      for (let i = 1; i < lines.length; i++) {
        const row = lines[i].split(",");
        if (row.length < header.length) continue;
        const t = parseInt(row[idx.time]);
        if (t0 === null) t0 = t;
        timeArr.push(((t - t0) / 1000).toFixed(2));
        axArr.push(parseFloat(row[idx.ax]));
        ayArr.push(parseFloat(row[idx.ay]));
        azArr.push(parseFloat(row[idx.az]));
        gxArr.push(parseFloat(row[idx.gx]));
        gyArr.push(parseFloat(row[idx.gy]));
        gzArr.push(parseFloat(row[idx.gz]));
        distArr.push(parseFloat(row[idx.dist]));
      }
      return {
        time: timeArr,
        accel: { x: axArr, y: ayArr, z: azArr },
        gyro: { x: gxArr, y: gyArr, z: gzArr },
        ultrasonic: distArr,
      };
    }

    // Auto-load CSV when page loads
    window.addEventListener("DOMContentLoaded", function () {
      const csvURL = "{% static 'main_app/data/data-sample.csv' %}";
      loadingSpinner.style.display = "block";

      fetch(csvURL)
        .then((res) => res.text())
        .then((text) => {
          const parsed = parseCSV(text);
          // Accelerometer
          accelerometerChart.data.labels = parsed.time.map(Number);
          accelerometerChart.data.datasets = [
            { label: "Accel X", data: parsed.accel.x, borderColor: "rgba(52,152,219,1)", backgroundColor: "rgba(52,152,219,0.2)", tension: 0.4, pointRadius: 2 },
            { label: "Accel Y", data: parsed.accel.y, borderColor: "rgba(39,174,96,1)", backgroundColor: "rgba(39,174,96,0.2)", tension: 0.4, pointRadius: 2 },
            { label: "Accel Z", data: parsed.accel.z, borderColor: "rgba(231,76,60,1)", backgroundColor: "rgba(231,76,60,0.2)", tension: 0.4, pointRadius: 2 }
          ];
          accelerometerChart.update();

          // Gyroscope
          gyroscopeChart.data.labels = parsed.time.map(Number);
          gyroscopeChart.data.datasets = [
            { label: "Gyro X", data: parsed.gyro.x, borderColor: "rgba(155,89,182,1)", backgroundColor: "rgba(155,89,182,0.2)", tension: 0.4, pointRadius: 2 },
            { label: "Gyro Y", data: parsed.gyro.y, borderColor: "rgba(241,196,15,1)", backgroundColor: "rgba(241,196,15,0.2)", tension: 0.4, pointRadius: 2 },
            { label: "Gyro Z", data: parsed.gyro.z, borderColor: "rgba(26,188,156,1)", backgroundColor: "rgba(26,188,156,0.2)", tension: 0.4, pointRadius: 2 }
          ];
          gyroscopeChart.update();

          // Ultrasonic
          ultrasonicChart.data.labels = parsed.time.map(Number);
          ultrasonicChart.data.datasets = [
            { label: "Distance (cm)", data: parsed.ultrasonic, borderColor: "rgba(39,174,96,1)", backgroundColor: "rgba(39,174,96,0.2)", tension: 0.4, pointRadius: 2 }
          ];
          ultrasonicChart.update();

          loadingSpinner.style.display = "none";
        })
        .catch((err) => {
          loadingSpinner.style.display = "none";
          alert("Error loading CSV: " + err.message);
        });
    });
  </script>

<script src="{% static 'main_app/js/darkmode.js' %}"></script>
 
</body>
</html>



